# Story 1.1: Project Scaffolding & CI Pipeline — Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create a working monorepo with .NET 10 backend, React 19 frontend, test infrastructure, linting, and CI pipeline — so the team has a verified foundation to build features on.

**Architecture:** Monorepo with two top-level app folders: `api/` (.NET Clean Architecture via Jason Taylor template) and `web/` (Vite + React + TypeScript). Single CI pipeline builds and tests both on every PR. Frontend proxies `/api/*` to the backend dev server.

**Tech Stack:** .NET 10, Jason Taylor Clean Architecture template v10.0.0, React 19, Vite 7, TypeScript (strict), Tailwind CSS v4, Vitest, Testing Library, MSW v2, ESLint (flat config), Prettier

---

## Testing Mode Declaration

| Task | Mode | Rationale |
|------|------|-----------|
| Task 1: .NET backend | Spike | Template generates its own tests; verify they pass |
| Task 2: React frontend | Spike | Scaffolding only; verify builds succeed |
| Task 3: Vite proxy | Spike | Manual verification when first API endpoint exists |
| Task 4: Frontend test infra | Test-first | Write smoke test first to prove test pipeline works |
| Task 5: ESLint + Prettier | Spike | Config verification; verify lint runs clean |
| Task 6: CI pipeline | Spike | Tested by pushing to PR branch |
| Task 7: Verification | N/A | Structural + pipeline verification |

---

## Task 1: Initialize .NET Backend

**Files:**
- Create: `api/` (entire directory tree — generated by template)
- Modify: `api/.editorconfig` (tighten severity rules)
- Modify: `.gitignore` (add .NET artifacts)

**Step 1: Install the Jason Taylor Clean Architecture template**

```bash
dotnet new install Clean.Architecture.Solution.Template::10.0.0
```

Expected: Template installed successfully. If already installed, that's fine too.

**Step 2: Generate the solution**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus
dotnet new ca-sln -o api --database SqlServer
```

Expected: `api/` directory created with `api.sln`, `src/` (Domain, Application, Infrastructure, Web), `tests/`, and config files.

**Step 3: Verify the build succeeds**

```bash
dotnet build /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/api/api.sln
```

Expected: Build succeeded with 0 errors. Warnings are acceptable at this stage.

**Step 4: Verify template tests pass**

```bash
dotnet test /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/api/api.sln
```

Expected: All template default tests pass.

**Step 5: Review and tighten .editorconfig**

Read `api/.editorconfig`. The template defaults may be too lenient — `dotnet format --verify-no-changes` might pass vacuously. Tighten severity to `warning` or `error` for key rules:

- Naming conventions (PascalCase for publics, _camelCase for private fields)
- Braces (Allman style)
- Spacing
- `var` usage preferences

The goal: `dotnet format --verify-no-changes` should actually catch real violations.

**Step 6: Verify dotnet format passes with tightened rules**

```bash
dotnet format /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/api/api.sln --verify-no-changes
```

Expected: No formatting violations. If violations are found, run `dotnet format api/api.sln` to fix them, then verify again.

**Step 7: Update .gitignore for .NET artifacts**

Add these entries to the root `.gitignore` (if not already present):

```
# .NET
bin/
obj/
.vs/
*.user
*.suo
*.userosscache
*.sln.docstates
```

**Step 8: Commit**

```bash
git add api/ .gitignore
git commit -m "feat(api): scaffold .NET backend with Clean Architecture template

Initialize api/ directory using Jason Taylor Clean Architecture v10.0.0
with SQL Server. Tighten .editorconfig severity for CI enforcement.
Update .gitignore for .NET artifacts."
```

---

## Task 2: Initialize React Frontend

**Files:**
- Create: `web/` (entire directory tree — generated by Vite template)
- Modify: `web/vite.config.ts` (add Tailwind plugin)
- Modify: `web/src/index.css` (add Tailwind import)

**Step 1: Generate the Vite app**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus
npm create vite@latest web -- --template react-ts
```

Expected: `web/` directory created with `package.json`, `vite.config.ts`, `tsconfig.json`, `src/`, etc.

**Step 2: Install dependencies**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npm install
```

Expected: `node_modules/` created, `package-lock.json` generated.

**Step 3: Install Tailwind CSS v4**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npm install tailwindcss @tailwindcss/vite
```

Expected: Both packages added to `package.json` dependencies.

**Step 4: Configure Tailwind plugin in vite.config.ts**

Replace `web/vite.config.ts` contents with:

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  plugins: [react(), tailwindcss()],
})
```

**Step 5: Add Tailwind import to index.css**

Replace `web/src/index.css` contents with:

```css
@import "tailwindcss";
```

**Step 6: Verify dev server starts**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npm run dev -- --host 0.0.0.0 &
sleep 3
curl -s http://localhost:5173 | head -5
kill %1
```

Expected: HTML response from Vite dev server.

**Step 7: Verify production build succeeds**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npm run build
```

Expected: `dist/` directory created with built assets.

**Step 8: Commit**

```bash
git add web/
git commit -m "feat(web): scaffold React frontend with Vite and Tailwind CSS v4

Initialize web/ directory using Vite 7 + React 19 + TypeScript template.
Install and configure Tailwind CSS v4 via @tailwindcss/vite plugin."
```

---

## Task 3: Configure Vite Proxy

**Files:**
- Modify: `web/vite.config.ts`

**Step 1: Add proxy configuration**

Update `web/vite.config.ts` to include the proxy:

```typescript
/// <reference types="vitest" />
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  plugins: [react(), tailwindcss()],
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:5001',
        changeOrigin: true,
      },
    },
  },
})
```

Note: The `/// <reference types="vitest" />` and `test` config are added in Task 4. For now, just add the proxy and the vitest reference type (needed once vitest is installed).

Actually — hold the vitest reference until Task 4. For this step, just add the proxy:

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  plugins: [react(), tailwindcss()],
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:5001',
        changeOrigin: true,
      },
    },
  },
})
```

**Step 2: Verify build still succeeds**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npm run build
```

Expected: Build succeeds (proxy config doesn't affect production builds).

**Step 3: Commit**

```bash
git add web/vite.config.ts
git commit -m "feat(web): configure Vite proxy for API requests

Route /api/* requests to .NET backend at localhost:5001
during development."
```

---

## Task 4: Set Up Frontend Test Infrastructure

**Files:**
- Modify: `web/package.json` (add test dependencies + script)
- Modify: `web/vite.config.ts` (add vitest config)
- Create: `web/src/test-setup.ts`
- Create: `web/src/test-utils.tsx`
- Create: `web/src/mocks/server.ts`
- Create: `web/src/mocks/handlers.ts`
- Create: `web/src/App.test.tsx`

**Testing mode: Test-first** — Write the smoke test first, then configure the infrastructure to make it pass.

**Step 1: Install test dependencies**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npm install -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom msw
```

**Step 2: Write the smoke test FIRST (test-first TDD)**

Create `web/src/App.test.tsx`:

```typescript
import { render, screen } from './test-utils'
import App from './App'

describe('App', () => {
  it('should render without crashing', () => {
    render(<App />)
    expect(document.querySelector('#root, [data-testid="app"], body')).toBeTruthy()
  })
})
```

Note: We intentionally keep this simple — just verify the component renders. The exact text depends on what the Vite template generates, so we check that the component mounts without throwing.

**Step 3: Create test-utils.tsx**

Create `web/src/test-utils.tsx`:

```typescript
import { render, RenderOptions } from '@testing-library/react'
import { ReactElement } from 'react'

const customRender = (ui: ReactElement, options?: RenderOptions) =>
  render(ui, { ...options })

export * from '@testing-library/react'
export { customRender as render }
```

**Step 4: Create MSW handlers**

Create `web/src/mocks/handlers.ts`:

```typescript
// Add handlers as API endpoints are created
export const handlers = []
```

**Step 5: Create MSW server**

Create `web/src/mocks/server.ts`:

```typescript
import { setupServer } from 'msw/node'
import { handlers } from './handlers'

export const server = setupServer(...handlers)
```

**Step 6: Create test setup file**

Create `web/src/test-setup.ts`:

```typescript
import '@testing-library/jest-dom'
import { server } from './mocks/server'
import { afterAll, afterEach, beforeAll } from 'vitest'

beforeAll(() => server.listen({ onUnhandledRequest: 'bypass' }))
afterEach(() => server.resetHandlers())
afterAll(() => server.close())
```

**Step 7: Configure Vitest in vite.config.ts**

Update `web/vite.config.ts`:

```typescript
/// <reference types="vitest" />
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  plugins: [react(), tailwindcss()],
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:5001',
        changeOrigin: true,
      },
    },
  },
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: ['./src/test-setup.ts'],
  },
})
```

**Step 8: Add test script to package.json**

Add to `web/package.json` scripts section:

```json
"test": "vitest"
```

**Step 9: Run the smoke test**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npx vitest run
```

Expected: 1 test passes. If the test fails, adjust the assertion in `App.test.tsx` to match the actual Vite template output (check what App.tsx renders).

**Step 10: Commit**

```bash
git add web/
git commit -m "feat(web): set up Vitest, Testing Library, and MSW test infrastructure

Install test dependencies. Configure Vitest with jsdom environment.
Create test-utils.tsx with custom render (no providers yet).
Set up MSW server with empty handlers.
Add smoke test proving the test pipeline works."
```

---

## Task 5: Configure ESLint + Prettier

**Files:**
- Modify: `web/package.json` (add dev dependencies + scripts)
- Create: `web/eslint.config.js`
- Create: `web/.prettierrc`

**Step 1: Install ESLint + Prettier packages**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npm install -D eslint prettier eslint-config-prettier eslint-plugin-import-x typescript-eslint @eslint/js globals
```

Note: Vite template may already include some ESLint dependencies. Install any missing ones.

**Step 2: Create eslint.config.js (flat config)**

Create `web/eslint.config.js`:

```javascript
import js from '@eslint/js'
import globals from 'globals'
import tseslint from 'typescript-eslint'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import importX from 'eslint-plugin-import-x'
import eslintConfigPrettier from 'eslint-config-prettier'

export default tseslint.config(
  { ignores: ['dist'] },
  {
    extends: [
      js.configs.recommended,
      ...tseslint.configs.recommended,
    ],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2024,
      globals: globals.browser,
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
      'import-x': importX,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
      'import-x/order': [
        'warn',
        {
          groups: [
            'builtin',
            'external',
            'internal',
            'parent',
            'sibling',
            'index',
            'type',
          ],
          'newlines-between': 'never',
          alphabetize: { order: 'asc', caseInsensitive: true },
        },
      ],
    },
  },
  eslintConfigPrettier,
)
```

Note: The Vite template may already generate an `eslint.config.js`. If so, modify it rather than replacing — keep any template-specific rules and add the import ordering + prettier config.

**Step 3: Create .prettierrc**

Create `web/.prettierrc`:

```json
{
  "semi": false,
  "singleQuote": true,
  "trailingComma": "all",
  "printWidth": 80,
  "tabWidth": 2
}
```

**Step 4: Add lint and format scripts to package.json**

Add to `web/package.json` scripts:

```json
"lint": "eslint .",
"format": "prettier --write .",
"format:check": "prettier --check ."
```

**Step 5: Run Prettier to fix formatting on generated code**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npx prettier --write .
```

**Step 6: Run ESLint and fix any issues**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npx eslint . --fix
```

Then verify:

```bash
npm run lint
```

Expected: 0 errors. Some warnings may be acceptable.

**Step 7: Verify tests still pass after linting changes**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npx vitest run
```

Expected: All tests still pass.

**Step 8: Commit**

```bash
git add web/
git commit -m "feat(web): configure ESLint flat config and Prettier

Set up ESLint with TypeScript, React hooks, and import ordering
via eslint-plugin-import-x. Add Prettier with project formatting rules.
All generated code passes lint and format checks."
```

---

## Task 6: Create CI Pipeline

**Files:**
- Create: `.github/workflows/ci.yml`

**Step 1: Create the CI workflow file**

Create `.github/workflows/ci.yml`:

```yaml
name: CI

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  api:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '10.0.x'
      - run: dotnet restore api/api.sln
      - run: dotnet build api/api.sln --no-restore
      - run: dotnet test api/api.sln --no-build
      - run: dotnet format api/api.sln --verify-no-changes

  web:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: web
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'
          cache: 'npm'
          cache-dependency-path: web/package-lock.json
      - run: npm ci
      - run: npm run lint
      - run: npm run build
      - run: npm run test -- --run
```

**Step 2: Commit**

```bash
git add .github/
git commit -m "ci: add GitHub Actions pipeline for API and web

Build and test both api/ (.NET) and web/ (React) on every PR
and push to main. Includes dotnet format enforcement and ESLint."
```

---

## Task 7: Verify Monorepo Structure & End-to-End Pipeline

**Step 1: Verify folder structure matches architecture doc**

Expected top-level structure:

```
recruitment-tracker/
├── .github/workflows/ci.yml
├── api/
│   ├── api.sln
│   ├── .editorconfig
│   ├── src/ (Domain, Application, Infrastructure, Web)
│   └── tests/ (Domain.UnitTests, Application.UnitTests, Application.FunctionalTests, Infrastructure.IntegrationTests)
├── web/
│   ├── package.json
│   ├── vite.config.ts
│   ├── eslint.config.js
│   ├── .prettierrc
│   └── src/ (main.tsx, App.tsx, index.css, test-utils.tsx, mocks/, App.test.tsx)
├── docs/
├── CLAUDE.md
└── .gitignore
```

Verify each expected file/directory exists.

**Step 2: Verify .gitignore covers both stacks**

Ensure `.gitignore` has entries for:
- .NET: `bin/`, `obj/`, `.vs/`, `*.user`
- Node: `node_modules/`, `dist/`

**Step 3: Check for secrets/PII in committed files**

```bash
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus
git diff --cached --name-only | xargs grep -l -i "password\|secret\|api.key\|connection.string" 2>/dev/null || echo "No secrets found"
```

**Step 4: Run full pipeline locally**

```bash
# Backend
dotnet build /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/api/api.sln
dotnet test /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/api/api.sln
dotnet format /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/api/api.sln --verify-no-changes

# Frontend
cd /home/thomasg/Projects/Web/recruitment-tracker-exp4-opus/web
npm ci
npm run lint
npm run build
npx vitest run
```

All must pass green.

**Step 5: Final commit (if any cleanup needed)**

```bash
git add -A
git commit -m "chore: verify monorepo structure and pipeline pass"
```

---

## Tests Added by This Story

| Test | Type | Risk Covered |
|------|------|-------------|
| Template default xUnit tests (backend) | Unit/Functional | Backend build pipeline integrity |
| `App.test.tsx` smoke test (frontend) | Component | Vitest + Testing Library + MSW pipeline works |

## Anti-Patterns to Avoid

- Do NOT install MSAL, TanStack Query, React Router, shadcn/ui, or react-pdf (later stories)
- Do NOT create domain entities or database migrations
- Do NOT use Moq — NSubstitute is mandatory
- Do NOT use `tailwind.config.js` — Tailwind CSS v4 uses zero-config
- Do NOT create path-filtered CI pipelines
- Do NOT over-engineer test-utils.tsx with providers for libraries not yet installed
